namespace = phi_ai

#	phi_ai.0	yearly checked - builds up the capital planet of non gestalt empires
#	phi_ai.1	yearly checked - builds up the other planets of non gestalt empires
#	phi_ai.2	yearly checked - manages unemployed pops of non gestalts empires
#	phi_ai.3	yearly checked - transfers pops between capital and colonies for non gestalts empires
#	phi_ai.4	yearly checked - market simulator for non gestalts empires
#	phi_ai.5	yearly checked - refines the capital planet of non-gestalt non-voids empires
#	phi_ai.6	yearly checked - finds empires lagging behind and flags them
#	phi_ai.7	yearly checked - better starbases
#	phi_ai.8	yearly checked - building assault armies
#	phi_ai.9	monthly checked - destroy "lost cause" starbases
#	phi_ai.10	yearly checked - send alloys to fed prez
#	phi_ai.11	monthly checked - set survive cb in defensive wars when hope is lost
#	phi_ai.12	monthly checked - joins defensive wars of laggers
#	phi_ai.13	5-yearly checked - shifts ethics towards fed type
#	phi_ai.14	monthly checked - scorched earth tactics
#	phi_ai.15	yearly checked - attack bbeg
#	phi_ai.16	yearly checked - market simulator for gestalts empires
#	phi_ai.17	yearly checked - refines the capital planet of gestalt 
#   phi_ai.17   if declare war AI subjucation
#   20-29		Replace Buildings
#	phi_ai.20	yearly checked - replace up building of  gestalt empires
#   30-39		Flags
#	phi_ai.30	yearly checked - Set Flag washuman
#   40-49			Mid Game District update
	#	phi_ai.40	Mid game District update only artificial planet
	#	phi_ai.41	Universally remove/replace pop assembly
#	set_colony_type

country_event = {
#	phi_ai.0	yearly checked - builds up the capital planet of non-gestalt non-voids empires

	id = phi_ai.0
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
		has_resource = { type = minerals amount > 500 }
		has_monthly_income = { resource = energy value > 20 }
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = yes
				NOT = { is_planet_class = pc_habitat }
			}
			random_list = {
				50 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_autochthon_monument value < 1 }
							owner = {
								NOR = {
									is_spiritualist = yes
									is_megacorp = yes
								}
							}
						}
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_temple value < 2 }
							owner = {
								is_spiritualist = yes
							}
						}
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_corporate_monument value < 1 }
							owner = {
								is_megacorp = yes
							}
						}
					}
					modifier = {
						factor = 10
						AND = {
							num_buildings = { type = building_engineering_lab_1 value > 2 }
						}
					}
					add_building = building_physics_lab_1
					owner = { add_resource = { minerals = -400 } }
				}
				50 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_autochthon_monument value < 1 }
							owner = {
								NOR = {
									is_spiritualist = yes
									is_megacorp = yes
								}
							}
						}
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_temple value < 2 }
							owner = {
								is_spiritualist = yes
							}
						}
					}
					modifier = {
						factor = 0
						AND = {
							num_buildings = { type = building_corporate_monument value < 1 }
							owner = {
								is_megacorp = yes
							}
						}
					}
					modifier = {
						factor = 10
						AND = {
							num_buildings = { type = building_physics_lab_1 value > 2 }
						}
					}
					add_building = building_engineering_lab_1
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						owner = {
							OR = {
								is_spiritualist = yes
								is_megacorp = yes
							}
						}
					}
					modifier = {
						factor = 0
						num_buildings = { type = building_autochthon_monument value > 0 }
					}
					add_building = building_autochthon_monument
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						owner = { is_spiritualist = no }
					}
					modifier = {
						factor = 0
						num_buildings = { type = building_temple value > 1 }
					}
					add_building = building_temple
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						owner = {
							OR = {
								is_spiritualist = yes
								is_megacorp = no
							}
						}
					}
					modifier = {
						factor = 0
						num_buildings = { type = building_corporate_monument value > 1 }
					}
					add_building = building_corporate_monument
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_city value = 0 }
					}
					modifier = {
						factor = 0
						free_building_slots > 0
					}
					add_district = district_city
					owner = { add_resource = { minerals = -400 } }
				}
			}
		}
	}
}

country_event = {
#	phi_ai.1	yearly checked - builds up the other planets of non gestalt empires

	id = phi_ai.1
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
		any_owned_planet = {
			is_capital = no
			is_under_colonization = no
		}
		has_resource = { type = minerals amount > 400 }
		has_monthly_income = { resource = energy value > 20 }
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = no
			}
			random_list = {
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_generator value = 0 }
					}
					modifier = {
						factor = 0
						owner = { has_monthly_income = { resource = energy value > 20 } }
					}
					add_district = district_generator
					owner = { add_resource = { minerals = -300 } }
				}
				15 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_mining value = 0 }
					}
					modifier = {
						factor = 0
						owner = { has_monthly_income = { resource = minerals value > 100 } }
					}
					modifier = {
						factor = 10
						owner = { has_monthly_income = { resource = minerals value < 50 } }
					}
					add_district = district_mining
					owner = { add_resource = { minerals = -300 } }
				}
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_farming value = 0 }
					}
					modifier = {
						factor = 0
						owner = { has_monthly_income = { resource = food value > 10 } }
					}
					add_district = district_farming
					owner = { add_resource = { minerals = -300 } }
				}
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_industrial value = 0 }
					}
					add_district = district_industrial
					owner = { add_resource = { minerals = -400 } }
				}
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_city value = 0 }
					}
					modifier = {
						factor = 0.1
						free_building_slots > 0
					}
					modifier = {
						factor = 100
						free_housing < 0
					}
					add_district = district_city
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						num_buildings = { type = building_foundry_1 value > 0 }
					}
					add_building = building_foundry_1
					owner = { add_resource = { minerals = -400 } }
				}
				100 = {
					modifier = {
						factor = 0
						free_building_slots = 0
					}
					modifier = {
						factor = 0
						num_buildings = { type = building_factory_1 value > 0 }
					}
					modifier = {
						factor = 0
						owner = { has_monthly_income = { resource = consumer_goods value > 5 } }
					}
					add_building = building_factory_1
					owner = { add_resource = { minerals = -400 } }
				}
			}
		}
	}
}

country_event = {
#	phi_ai.2	yearly checked - manages unemployed pops for NOT gestalt consciousness

	id = phi_ai.2
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
		any_owned_pop = { is_unemployed = yes }
		any_owned_planet = {
			is_capital = no
			is_under_colonization = no
		}
		OR = {
			AND = {
				has_resource = { type = energy amount > 500 }
				has_resource = { type = unity amount > 10 }
			}
			has_civic = civic_corvee_system
		}
	}
	
	immediate = {
		while = {
			count = 10
			limit = {
				OR = {
					AND = {
						has_resource = { type = energy amount > 500 }
						has_resource = { type = unity amount > 10 }
					}
					has_civic = civic_corvee_system
				}
				any_owned_pop = {
					is_unemployed = yes
				}
				any_owned_planet = {
					free_housing > 0
					free_jobs > 0
					num_unemployed = 0
				}
			}
			random_owned_planet = {
				
				limit = {
					any_owned_pop = {
						is_unemployed = yes
					}
					
				}
				save_event_target_as = planet_option_start 
			}
			random_owned_pop = {
				limit = { 
					is_unemployed = yes
					planet = {
						is_same_value = event_target:planet_option_start
					} 
				}
				root = { 
					random_owned_planet = {
						limit = { 
							free_housing > 0
							free_jobs > 0
							num_unemployed < 1
							NOT = { is_same_value = event_target:planet_option_start } 
						}
						resettle_pop = {
							pop = prevprev
							planet = this
						}
						owner  = {
							if = {
								limit = { NOT = { has_civic = civic_corvee_system } }
								add_resource = { energy = -100 }
								add_resource = { unity = -10 }
							}
						}
					}
				}
			}
		}
	}
}

country_event = {
#	phi_ai.3	yearly checked - transfers pops between capital and colonies for non gestalts empires

	id = phi_ai.3
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
		capital_scope = {
			num_pops > 50
			free_amenities > 5
			any_owned_pop = { has_job = clerk }
		}
		any_owned_planet = {
			free_housing > 0
			free_jobs > 0
			num_unemployed = 0
		}
		OR = {
			AND = {
				has_resource = { type = energy amount > 500 }
				has_resource = { type = unity amount > 300 }
			}
			has_civic = civic_corvee_system
		}
	}
	
	immediate = {
		while = {
			limit = {
				OR = {
					AND = {
						has_resource = { type = energy amount > 500 }
						has_resource = { type = unity amount > 300 }
					}
					has_civic = civic_corvee_system
				}
				capital_scope = {
					num_pops > 50
					free_amenities > 5
					any_owned_pop = { has_job = clerk }
				}
				any_owned_planet = {
					is_capital = no
					free_jobs > 0
				}				
			}
			capital_scope = {
				random_owned_pop = {
					limit = { has_job = clerk }
					root = {
						random_owned_planet = {
							limit = {
								free_housing > 0
								is_capital = no
								free_jobs > 0
								num_unemployed = 0
							}
							create_pop = {
								species = prevprev
							}
						}
					}
					kill_pop = yes
				}
			}
			if = {
				limit = { NOT = { has_civic = civic_corvee_system } }
				add_resource = { energy = -100 }
				add_resource = { unity = -10 }
			}
		}
	}
}

country_event = {
#	phi_ai.4	yearly checked - market simulator for non gestalts empires

	id = phi_ai.4
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
	}
	
	immediate = {
		while = {
			limit = {
				has_resource = { type = consumer_goods amount > 2000 }
				has_monthly_income = { resource = consumer_goods value > 0 }
			}
			add_resource = { consumer_goods = -200 }
			add_resource = { energy = 200 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 500 }
				has_resource = { type = food amount < 500 }
				has_monthly_income = { resource = food value < 0 }
				has_monthly_income = { resource = energy value > 0 }
			}
			add_resource = { food = 500 }
			add_resource = { energy = -500 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1500 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = minerals amount < 500 }
			}
			add_resource = { minerals = 500 }
			add_resource = { energy = -500 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1500 }
				has_monthly_income = { resource = energy value > 0 }
				has_monthly_income = { resource = consumer_goods value < 0 }
				has_resource = { type = consumer_goods amount < 100 }
			}
			add_resource = { consumer_goods = 12 }
			add_resource = { energy = -24 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1500 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = minerals amount < 1000 }
			}
			add_resource = { minerals = 500 }
			add_resource = { energy = -500 }
		}
		if = {
			limit = {
				has_resource = { type = minerals amount > 12000 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = alloys amount < 10000 }
			}
			add_resource = { alloys = 300 }
			add_resource = { minerals = -2000 }
		}
		if = {
			limit = {
				has_resource = { type = minerals amount > 12000 }
				has_resource = { type = energy amount < 20000 }
			}
			add_resource = { energy = 2000 }
			add_resource = { minerals = -2000 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 11000 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = alloys amount < 10000 }
			}
			add_resource = { alloys = 1000 }
			add_resource = { energy = -6000 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1000 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = exotic_gases amount < 500 }
			}
			add_resource = { exotic_gases = 3 }
			add_resource = { energy = -10 }
		}
	}
}

country_event = {
#	phi_ai.5	yearly checked - refines the capital planet of non-gestalt non-voids empires

	id = phi_ai.5
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		NOT = { has_ethic = ethic_gestalt_consciousness }
	}
	
	immediate = {
		random_owned_planet = {
			limit = {
				is_capital = yes
				NOT = { is_planet_class = pc_habitat }
			}
			if = {
				limit = {
					owner = {
						has_monthly_income = { resource = food value > 20 }
						NOT = { has_valid_civic = civic_agrarian_idyll }
					}
					num_districts = { type = district_farming value > 0 }
				}
				remove_district = district_farming
				random_list = {
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = energy value > 20 } }
						}
						modifier = {
							factor = 0
							free_jobs > 0
						}
						add_district = district_generator
					}
					50 = {
						modifier = {
							factor = 0
							owner = { has_resource = { type = minerals amount < 100 } }
						}
						owner = { add_resource = { minerals = -100 } }
						add_district = district_city
					}
				}
			}
			if = {
				limit = {
					owner = { has_monthly_income = { resource = minerals value > 100 } }
					num_districts = { type = district_mining value > 0 }
				}
				remove_district = district_mining
				random_list = {
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = energy value > 20 } }
						}
						modifier = {
							factor = 0
							free_jobs > 0
						}
						add_district = district_generator
					}
					50 = {
						modifier = {
							factor = 0
							owner = { has_resource = { type = minerals amount < 100 } }
						}
						modifier = {
							factor = 0
							owner = { has_valid_civic = civic_agrarian_idyll }
							num_free_districts = { type = district_farming value > 0 }
						}
						owner = { add_resource = { minerals = -100 } }
						add_district = district_city
					}
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_farming value = 0 }
						}
						modifier = {
							factor = 0
							owner = { NOT = { has_valid_civic = civic_agrarian_idyll } }
						}
						add_district = district_farming
					}
				}
			}
		}
		random_owned_planet = {
			limit = {
				is_capital = no
				NOT = { is_planet_class = pc_habitat }
				NOT = { is_planet_class = pc_city } # ecumenopolis
			}
			if = {
				limit = {
					owner = {
						has_monthly_income = { resource = food value > 20 }
						NOT = { has_valid_civic = civic_agrarian_idyll }
					}
					num_districts = { type = district_farming value > 0 }
				}
				remove_district = district_farming
				random_list = {
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = energy value > 20 } }
						}
						modifier = {
							factor = 0
							free_jobs > 0
						}
						add_district = district_generator
					}
					50 = {
						modifier = {
							factor = 0
							owner = { has_resource = { type = minerals amount < 100 } }
						}
						owner = { add_resource = { minerals = -100 } }
						add_district = district_city
					}
				}
			}
			if = {
				limit = {
					owner = { has_monthly_income = { resource = minerals value > 100 } }
					num_districts = { type = district_mining value > 0 }
				}
				remove_district = district_mining
				random_list = {
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = energy value > 20 } }
						}
						modifier = {
							factor = 0
							free_jobs > 0
						}
						add_district = district_generator
					}
					50 = {
						modifier = {
							factor = 0
							owner = { has_resource = { type = minerals amount < 100 } }
						}
						modifier = {
							factor = 0
							owner = { has_valid_civic = civic_agrarian_idyll }
							num_free_districts = { type = district_farming value > 0 }
						}
						owner = { add_resource = { minerals = -100 } }
						add_district = district_city
					}
					50 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_farming value = 0 }
						}
						modifier = {
							factor = 0
							owner = { NOT = { has_valid_civic = civic_agrarian_idyll } }
						}
						add_district = district_farming
					}
				}
			}
		}
	}
}
#git
country_event = {
#	phi_ai.6	yearly checked - finds empires lagging behind and flags them

	id = phi_ai.6
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_country_type = default
	}
	
	immediate = {
		# clears the flag for the country
		if = {
			limit = { has_country_flag = phi_lagger }
			remove_country_flag = phi_lagger
		}
		
		# let's assume the country is a big bad evil guy
		set_country_flag = phi_bbeg
		
		if = {
			limit = {
				#
				#check 1: if root is in a federation, is the prez weak?
				OR = {
					has_federation = no
					is_federation_leader = yes
					any_federation_ally = {
						is_federation_leader = yes
						any_country = {
							is_country_type = default
							has_communications = prev
							relative_power = {
								who = root
								category = fleet
								value >= equivalent # io sono uguale o più debole di lui? <= equivalent?
							}
						}
					}
				}
				
				#check 2: is root weak?
				any_country = {
					is_country_type = default
					has_communications = root
					NOT = { is_in_federation_with = root }
					OR = {
						AND = {
							relative_power = {
								who = root
								category = fleet
								value >= equivalent # io sono più debole di lui? < equivalent?
							}
							OR = {
								fleet_power > 20000
								root = { fleet_power > 4000 }
							}
						}
						AND = {
							NOR = { 
									has_policy_flag = diplo_stance_minimal_army
									has_policy_flag = diplo_stance_disarmament
							}
							relative_power = {
								who = root
								category = technology
								value >= equivalent
							}
						}
					}
				}
			}
			remove_country_flag = phi_bbeg
			set_country_flag = phi_lagger
		}
		
		#human players or if was human player and homicidal are never weak
		if = {
			limit = {
				OR = {
					is_ai = no
					is_homicidal = yes
					has_country_flag = was_human
				}
				has_country_flag = phi_lagger
			}
			remove_country_flag = phi_lagger
		}
		
		#excludes the baddies from weak definition
		if = {
			limit = {
				has_country_flag = phi_lagger
				OR = {
					is_homicidal = yes
					has_valid_civic = civic_criminal_heritage
				}
			}
			remove_country_flag = phi_lagger
		}
	}
}


country_event = {
#	phi_ai.7	yearly checked - better starbases

	id = phi_ai.7
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
	}
	
	immediate = {
		if = {
			limit = { has_technology = "tech_hydroponics" }
			every_owned_starbase = {
				limit = { has_starbase_building = listening_post }
				remove_starbase_building = { building = listening_post }
			}
		}
	}
}

country_event = {
#	phi_ai.8	yearly checked - building assault armies

	id = phi_ai.8
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		fleet_power > 5000
		num_armies < 30
		has_resource = { type = minerals amount > 2000 }
	}
	
	immediate = {
		capital_scope = {
			while = {
				count = 8
				create_army = {
					name = random
					owner = root
					species = root
					type = "assault_army"
				}
				owner = { add_resource = { minerals = -100 } }
			}
		}
	}
}

country_event = {
#	phi_ai.9	monthly checked - destroy "lost cause" starbases

	id = phi_ai.9
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		is_at_war = yes
	}
	immediate = {
		every_owned_starbase = {
			limit = {
				OR = {
					AND = {
						has_starbase_size = starbase_starport
						solar_system = {
							is_capital_system = no
							# NOT = {
							# 	any_fleet_in_system = {
							# 		exists = owner
							# 		owner = { is_same_value = root }
							# 		NOT = { is_same_value = prevprev }
							# 		fleet_power > 4000
							# 	}
							# }
							any_neighbor_system = {
								any_fleet_in_system = {
									exists = owner
									owner = { is_at_war_with = root }
									fleet_power > 4000
								}
							}
						}
					}
					AND = {
						has_starbase_size = starbase_starhold
						solar_system = {
							is_capital_system = no
							# NOT = {
							# 	any_fleet_in_system = {
							# 		exists = owner
							# 		owner = { is_same_value = root }
							# 		NOT = { is_same_value = prevprev }
							# 		fleet_power > 6000
							# 	}
							# }
							any_neighbor_system = {
								any_fleet_in_system = {
									exists = owner
									owner = { is_at_war_with = root }
									fleet_power > 11000
								}
							}
						}
					}
					AND = {
						has_starbase_size = starbase_starfortress
						solar_system = {
							is_capital_system = no
							# NOT = {
							# 	any_fleet_in_system = {
							# 		exists = owner
							# 		owner = { is_same_value = root }
							# 		NOT = { is_same_value = prevprev }
							# 		fleet_power > 8000
							# 	}
							# }
							any_neighbor_system = {
								any_fleet_in_system = {
									exists = owner
									owner = { is_at_war_with = root }
									fleet_power > 20000
								}
							}
						}
					}
					AND = {
						has_starbase_size = starbase_citadel
						solar_system = {
							is_capital_system = no
							# NOT = {
							# 	any_fleet_in_system = {
							# 		exists = owner
							# 		owner = { is_same_value = root }
							# 		NOT = { is_same_value = prevprev }
							# 		fleet_power > 10000
							# 	}
							# }
							any_neighbor_system = {
								any_fleet_in_system = {
									exists = owner
									owner = { is_at_war_with = root }
									fleet_power > 25000
								}
							}
						}
					}
				}
			}
			remove_starbase_module = { slot = all }
			remove_starbase_building = { slot = all }
			set_starbase_size = starbase_outpost
		}
	}
}

country_event = {
#	phi_ai.10	yearly checked - send alloys to fed prez

	id = phi_ai.10
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		is_homicidal = no
		is_subject = no
		has_federation = yes
		is_federation_leader = no
		has_resource = { type = alloys amount > 500 }
		has_monthly_income = { resource = alloys value > 10 }
	}
	
	immediate = {
		random_federation_ally = {
			limit = {
				is_federation_leader = yes
				is_ai = yes
				has_resource = { type = alloys amount < 10000 }
				has_monthly_income = { resource = alloys value < 200 }
			}
			add_resource = { alloys = 250 }
			root = { add_resource = { alloys = -250 } }
		}
	}
}

country_event = {
#	phi_ai.11	monthly checked - set survive cb in defensive wars when hope is lost

	id = phi_ai.11
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		is_at_war = yes
		any_war = {
			any_defender = {
				is_same_value = root
				is_war_leader = yes
			}
			NOR = {
				using_war_goal = { type = wg_phi_survive owner = root }
				War_Valid_survive = no #wg border wg_end_threat_ae
				using_war_goal = { type = wg_declared_crisis owner = attacker }
				using_war_goal = { type = wg_humiliation owner = attacker }
			}
			any_attacker = {
				relative_power = {
					who = root
					category = fleet
					value > equivalent
				}
			}
		}
		is_homicidal = no
		has_country_flag = phi_lagger
	}
	
	immediate = {
		random_list = {
			8  = {
				modifier = {
					factor = 2.5
					OR = {
						has_deficit = energy
						has_deficit = consumer_goods
						fleet_power < 1000
						has_modifier = country_defaulted
					}
				}
				every_war = {
					limit = {
						any_defender = {
							is_same_value = root
						}
						any_attacker = {
							relative_power = {
								who = root
								category = fleet
								value > equivalent
							}
						}
						NOR = {
							using_war_goal = { type = wg_phi_survive owner = root }
							using_war_goal = { type = wg_humiliation owner = attacker }
							War_Valid_survive = no #wg border
							using_war_goal = { type = wg_declared_crisis owner = attacker }
							using_war_goal = { type = wg_ae_domination owner = attacker }
							using_war_goal = { type = wg_end_threat_ae owner = attacker }
							using_war_goal = { type = wg_humiliation owner = attacker }
						}
					}
					set_war_goal = { type = wg_phi_survive target = root enemy = attacker }
				}
			}
			93 = {}
		}
	}
}

country_event = {
#	phi_ai.12	monthly checked - joins defensive wars of laggers
# root is joiner
	id = phi_ai.12
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		AND = {
			is_ai = yes
			is_country_type = default
			NOT = { has_country_flag = was_human }
			is_subject = no
			is_homicidal = no
			has_country_flag = phi_lagger
			OR = {
				has_federation = no
				is_federation_leader = yes
			}
			NAND = {
				is_at_war = yes
				any_war = {
					any_attacker = {
						is_same_value = root
					}
				}
			}
			fleet_power > 2000
			OR = {
				mid_game_years_passed > 25
				NOT = { has_country_flag = is_advanced_start_AI }
			}
			
			any_country = {
				has_communications = root
				opinion_level = { who = root level >= neutral }
				is_at_war = yes
				any_war = {
					using_war_goal = { type = wg_phi_survive owner = prev }
				}
			}
		}
	}
	
	immediate = {
		random_list = {
			5  = {
				modifier = {
					factor = 2
					years_passed < 30
					fleet_power > 8000
				}
				modifier = {
					factor = 2
					years_passed < 50
					fleet_power > 16000
				}
				modifier = {
					factor = 2
					fleet_power > 32000
				}
				modifier = {
					factor = 2
					has_ai_personality = honorbound_warriors
				} 	
				modifier = {
					factor = 0.5
					has_ai_personality_behaviour = isolationist
				}				
				random_country = {
					limit = { #how need country that can help
						AND = {
							is_homicidal = no
							is_at_war = yes
							has_communications = root
							opinion_level = { who = root level >= neutral }
							any_war = {
								using_war_goal = { type = wg_phi_survive owner = prev }
								NOT = { is_war_participant = { who = root } }
								defender_war_exhaustion < 0.5
								attacker = {
									root = { opinion_level = { who = prev level < neutral } }
									NOT = { has_truce = root } #non puoi entrare se hai un truce
								}
								defender = {
									NOT = { has_truce = root } #non puoi entrare se hai un truce
									NOT = { is_at_war_with = root }# non puoi entrare se sei in guerra con il difensore
								}
							}
							#has_country_flag = phi_lagger
							OR = {
								mid_game_years_passed > 25
								AND = {
									NOT = { has_country_flag = is_advanced_start_AI }
									NOT = { has_origin = origin_imperial_vassal_overlord }
								}
							}
						}
					}
					random_war = {
						limit = {
							NOT = { is_war_participant = { who = root } }
							using_war_goal = { type = wg_phi_survive owner = defender }
							any_defender = {
								is_same_value = prevprev
							}
						}
						save_event_target_as = survive_cb_war
					}
					if = {
						limit = { 
							exists = event_target:survive_cb_war 
							is_homicidal = no 
						}
						root = {
							if = {
								
								join_war_on_side = {
									war = event_target:survive_cb_war
									side = defenders
								}
								if = {
									limit = { is_federation_leader = yes }
									every_federation_ally = {
										join_war_on_side = {
											war = event_target:survive_cb_war
											side = defenders
										}
									}
								}
							}
						}
					}
				}
			}
			95 = {
				modifier = {
					factor = 2
					OR = {
						has_deficit = energy
						has_deficit = consumer_goods
						fleet_power < 1000
						has_modifier = country_defaulted
					}
				}
			}
		}
	}
}

country_event = {
#	phi_ai.13	yearly checked - shifts ethics towards fed type

	id = phi_ai.13
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		has_federation = yes
		NOT = { has_ethic = ethic_gestalt_consciousness }
		has_resource = { type = influence amount > 500 }
	}
	
	immediate = {
		if = {
			limit = {
				federation = { has_federation_type = xenophile_federation }
				NOT = { has_ethic = ethic_fanatic_xenophile }
			}
			shift_ethic = ethic_xenophile
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = militarist_federation }
				NOT = { has_ethic = ethic_fanatic_militarist }
			}
			shift_ethic = ethic_militarist
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = pacifist_federation }
				NOT = { has_ethic = ethic_fanatic_pacifist }
			}
			shift_ethic = ethic_pacifist
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = spiritualist_federation }
				NOT = { has_ethic = ethic_fanatic_spiritualist }
			}
			shift_ethic = ethic_spiritualist
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = materialist_federation }
				NOT = { has_ethic = ethic_fanatic_materialist }
			}
			shift_ethic = ethic_materialist
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = authoritarian_federation }
				NOT = { has_ethic = ethic_fanatic_authoritarian }
			}
			shift_ethic = ethic_authoritarian
			add_resource = { influence = -500 }
		}
		if = {
			limit = {
				federation = { has_federation_type = egalitarian_federation }
				NOT = { has_ethic = ethic_fanatic_egalitarian }
			}
			shift_ethic = ethic_egalitarian
			add_resource = { influence = -500 }
		}
	}
}

country_event = {
#	phi_ai.14	monthly checked - scorched earth tactics

	id = phi_ai.14
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		is_at_war = yes
	}
	
	immediate = {
		every_owned_fleet = {
			limit = {
				OR = {
					is_ship_size = mining_station
					is_ship_size = research_station
					is_ship_size = observation_station
				}
				solar_system = {
					NOT = { owner = { is_same_value = root } }
				}
			}
			destroy_fleet = this
		}
	}
}

country_event = {
#	phi_ai.15	yearly checked - attack bbeg

	id = phi_ai.15
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		is_at_war = no
		has_federation = yes
		is_federation_leader = yes
		any_playable_country = {
			has_country_flag = phi_bbeg
			has_communications = root
			NOR = {
				has_truce = root
				has_association_status = root
				is_in_federation_with = root
			}
		}
	}
	
	immediate = {
		federation = {
			export_trigger_value_to_variable = {
				trigger = fleet_power
				variable = phi_total_fleet
			}
		}
		random_playable_country = {
			limit = {
				has_country_flag = phi_bbeg
				has_communications = root
				NOR = {
					has_truce = root
					has_association_status = root
					is_in_federation_with = root
				}
				OR = {
					#if bbeg has no federation, checks for its fleet
					AND = {
						has_federation = no
						check_variable_arithmetic = {
							which = root.federation.phi_total_fleet
							subtract = trigger:fleet_power
							value > 10000
						}
					}
					#if bbeg has a federation, checks for its fed total power
					AND = {
						has_federation = yes
						check_variable_arithmetic = {
							which = root.federation.phi_total_fleet
							subtract = federation.trigger:fleet_power
							value > 10000
						}
					}
				}
			}
			root = {
				if = {
					limit = {
						any_federation_ally = {
							any_system_within_border = {
								has_hyperlane_to = prevprevprev
							}
						}
					}
					if = {
						limit = {
							prev = {
								OR = {
									has_valid_civic = civic_fanatic_purifiers
									has_valid_civic = civic_machine_terminator
									has_valid_civic = civic_hive_devouring_swarm
									has_valid_civic = civic_machine_assimilator
								}
							}
						}
						if = {
							limit = {
								prev = {
									OR = {
										has_valid_civic = civic_fanatic_purifiers
										has_valid_civic = civic_machine_terminator
									}
								}
							}
							declare_war = {
								target = prev
								attacker_war_goal = wg_end_threat
							}
						}
						else_if = {
							limit = {
								prev = {
									has_valid_civic = civic_hive_devouring_swarm
								}
							}
							declare_war = {
								target = prev
								attacker_war_goal = wg_end_threat_swarm
							}
						}
						else_if = {
							limit = {
								prev = {
									has_valid_civic = civic_machine_assimilator
								}
							}
							declare_war = {
								target = prev
								attacker_war_goal = wg_end_threat_assimilators
							}
						}
					}
				}
				else_if = {
					limit = {
						has_tradition = tr_domination_adopt
						prev = { is_homicidal = no }
					}
					if = {
						limit = { has_authority = auth_corporate }
						declare_war = {
							target = prev
							attacker_war_goal = wg_megacorp_subjugate
						}
					}
					else = {
						declare_war = {
							target = prev
							attacker_war_goal = wg_subjugation
						}
					}
				}
				else_if = {
					limit = {
						any_federation_ally = {
							has_claim = prevprev
						}
						prev = { is_homicidal = no }
					}
					declare_war = {
						target = prev
						attacker_war_goal = wg_conquest
					}
				}
				else_if = {
					limit = {
						prev = { is_homicidal = no }
					}
					declare_war = {
						target = prev
						attacker_war_goal = wg_humiliation
					}
				}
			}
		}
	}
}

country_event = {
#	phi_ai.16	yearly checked - market simulator for gestalts empires

	id = phi_ai.16
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_ai = yes
		is_country_type = default
		has_ethic = ethic_gestalt_consciousness
	}
	
	immediate = {
		if = {
			limit = {
				has_resource = { type = energy amount > 500 }
				has_resource = { type = food amount < 500 }
				has_monthly_income = { resource = food value < 0 }
				has_monthly_income = { resource = energy value > 0 }
			}
			add_resource = { food = 500 }
			add_resource = { energy = -500 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1000 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = minerals amount < 500 }

			}
			add_resource = { minerals = 500 }
			add_resource = { energy = -500 }
		}
		if = {
			limit = {
				has_resource = { type = minerals amount > 12000 }
				has_monthly_income = { resource = energy value > 0 }
				has_resource = { type = alloys amount < 10000 }
			}
			add_resource = { alloys = 15 }
			add_resource = { minerals = -20 }
		}
		if = {
			limit = {
				has_resource = { type = minerals amount > 12000 }
				has_resource = { type = energy amount < 20000 }
			}
			add_resource = { energy = 2000 }
			add_resource = { minerals = -2000 }
		}
		if = {
			limit = {
				has_resource = { type = energy amount > 1000 }
				has_monthly_income = { resource = energy value > 10 }
				has_resource = { type = exotic_gases amount < 500 }
			}
			add_resource = { exotic_gases = 3 }
			add_resource = { energy = -10 }
		}
	}
}
country_event = {
	#	phi_ai.20	yearly checked - replace up building of  gestalt empires
	
		id = phi_ai.20
		hide_window = yes
	
		is_triggered_only = yes
		
		trigger = {
			is_ai = yes
			is_country_type = default
			NOT = { has_country_flag = was_human }
			has_ethic = ethic_gestalt_consciousness
			has_resource = { type = minerals amount > 400 }
			has_monthly_income = { resource = energy value > 20 }
		}
		immediate = {
			random_owned_planet = {
				limit = {
					num_unemployed >= 20 # clean spawning_pool
				}
				random_list = {
					1 = { }
					50 = {
						modifier = {
							factor = 0
							OR = {
								is_capital = no
								num_pops > 70
								num_buildings = { type = building_spawning_pool value < 2 }
							}
							num_buildings = { type = building_spawning_pool value = 0 }
						}
						remove_building = building_spawning_pool
						random_list = {
							50 = {
								modifier = {
									factor = 0
									free_building_slots = 0
								}
								modifier = {
									factor = 0
									num_buildings = { type = building_foundry_1 value > 0 }
								}
								add_building = building_foundry_1
								owner = { add_resource = { minerals = -400 } }
							}
							25 = {
								modifier = {
									factor = 0
									free_building_slots = 0
								}
								add_building = building_engineering_lab_1
								owner = { add_resource = { minerals = -400 } }
								
							}
							25 = {
								modifier = {
									factor = 0
									free_building_slots = 0
								}
								add_building = building_physics_lab_1
								owner = { add_resource = { minerals = -400 } }
							}
						}
					}
				}
			}
			random_owned_planet = {
				limit = {
					num_pops > 5
					is_capital = no
					NOT = { is_planet_class = pc_habitat }
				}
				random_list = {
					10 = {
						
					}
					20 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = energy value > 20 } }
						}
						add_district = district_generator
						owner = { add_resource = { minerals = -300 } }
					}
					15 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_mining value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = minerals value > 100 } }
						}
						modifier = {
							factor = 10
							owner = { has_monthly_income = { resource = minerals value < 50 } }
						}
						add_district = district_mining
						owner = { add_resource = { minerals = -300 } }
					}
					20 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_farming value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = food value > 10 } }
						}
						add_district = district_farming
						owner = { add_resource = { minerals = -300 } }
					}
					20 = {
						modifier = {
							factor = 0
							num_districts = { type = district_farming value = 0 }
						}
						modifier = {
							factor = 100
							owner = { has_monthly_income = { resource = food value > 50 } }
						}
						remove_district = district_farming
						owner = { add_resource = { minerals = 300 } }
					}
					40 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_industrial value = 0 }
						}
						add_district = district_industrial
						owner = { add_resource = { minerals = -400 } }
					}
					20 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_city value = 0 }
						}
						modifier = {
							factor = 0.1
							free_building_slots > 0
						}
						modifier = {
							factor = 100
							free_housing < 0
						}
						add_district = district_city
						owner = { add_resource = { minerals = -400 } }
					}
					100 = {
						modifier = {
							factor = 0
							free_building_slots = 0
						}
						modifier = {
							factor = 0
							num_buildings = { type = building_foundry_1 value > 0 }
						}
						add_building = building_foundry_1
						owner = { add_resource = { minerals = -400 } }
					}
				}
			}
			random_owned_planet = {
				limit = {
					is_capital = yes
					NOT = { is_planet_class = pc_habitat }
				}
				random_list = {
					75 = {
						modifier = {
							factor = 0
							free_building_slots = 0
						}
						modifier = {
							factor = 10
							AND = {
								num_buildings = { type = building_engineering_lab_1 value > 2 }
							}
						}
						add_building = building_physics_lab_1
						owner = { add_resource = { minerals = -400 } }
					}
					50 = {
						modifier = {
							factor = 0
							free_building_slots = 0
						}
						modifier = {
							factor = 10
							AND = {
								num_buildings = { type = building_physics_lab_1 value > 2 }
							}
						}
						add_building = building_engineering_lab_1
						owner = { add_resource = { minerals = -400 } }
					}
					100 = {
						modifier = {
							factor = 0
							owner = { is_hive_empire = yes }
						}
						modifier = {
							factor = 0
							num_free_districts = { type = district_hive value = 0 }
						}
						modifier = {
							factor = 0
							free_building_slots > 0
						}
						add_district = district_hive
						owner = { add_resource = { minerals = -400 } }
					}
					100 = {
						modifier = {
							factor = 0
							owner = { is_machine_empire = yes }
						}
						modifier = {
							factor = 0
							num_free_districts = { type = district_nexus value = 0 }
						}
						modifier = {
							factor = 0
							free_building_slots > 0
						}
						add_district = district_nexus
						owner = { add_resource = { minerals = -400 } }
					}
					100 = {
						modifier = {
							factor = 0
							owner = { is_hive_empire = yes }
						}
						modifier = {
							factor = 0
							num_free_districts = { type = district_industrial value = 0 }
						}
						add_district = district_industrial
						owner = { add_resource = { minerals = -400 } }
					}
				}
			}
		}
	}
country_event = {
	#	phi_ai.17	yearly checked - refines the capital planet of gestalt 
	
		id = phi_ai.17
		hide_window = yes
	
		is_triggered_only = yes
		
		trigger = {
			is_ai = yes
			is_country_type = default
			has_ethic = ethic_gestalt_consciousness
		}
		
		immediate = {
			random_owned_planet = {
				limit = {
					is_capital = yes
					NOT = { is_planet_class = pc_habitat }
				}
				if = {
					limit = {
						owner = {
							has_monthly_income = { resource = food value > 40 }
							NOT = { has_valid_civic = civic_agrarian_idyll }
						}
						num_districts = { type = district_farming value > 0 }
					}
					remove_district = district_farming
					random_list = {
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value = 0 }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = energy value > 20 } }
							}
							modifier = {
								factor = 0
								free_jobs > 0
							}
							add_district = district_generator
						}
						50 = {
							modifier = {
								factor = 0
								owner = { has_resource = { type = minerals amount < 50 } }
							}
							owner = { add_resource = { minerals = -100 } }
							add_district = district_city
						}
						50 = {
							add_district = district_industrial
							owner = { add_resource = { minerals = -100 } }
						}
					}
				}
				if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value > 100 } }
						num_districts = { type = district_mining value > 0 }
					}
					remove_district = district_mining
					random_list = {
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value = 0 }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = energy value > 20 } }
							}
							modifier = {
								factor = 0
								free_jobs > 0
							}
							add_district = district_generator
						}
						50 = {
							modifier = {
								factor = 0
								owner = { has_resource = { type = minerals amount < 100 } }
							}
							modifier = {
								factor = 0
								owner = { has_valid_civic = civic_agrarian_idyll }
								num_free_districts = { type = district_farming value > 0 }
							}
							modifier = {
								factor = 0
								free_building_slots > 0
								num_buildings = { type = any value = 12 }
							}
							owner = { add_resource = { minerals = -100 } }
							add_district = district_city
						}
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_farming value = 0 }
							}
							modifier = {
								factor = 0
								owner = { NOT = { has_valid_civic = civic_agrarian_idyll } }
							}
							modifier = {
								factor = 0
								owner = { country_uses_food = no }
							}
							add_district = district_farming
						}
						50 = {
							add_district = district_industrial
							owner = { add_resource = { minerals = -100 } }
						}
					}
				}
			}
			random_owned_planet = {
				limit = {
					is_capital = no
					NOT = { is_planet_class = pc_habitat }
					NOT = { is_planet_class = pc_city } # ecumenopolis
				}
				if = {
					limit = {
						owner = {
							has_monthly_income = { resource = food value > 25 }
							NOT = { has_valid_civic = civic_agrarian_idyll }
						}
						num_districts = { type = district_farming value > 0 }
					}
					remove_district = district_farming
					random_list = {
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value = 0 }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = energy value > 20 } }
							}
							modifier = {
								factor = 0
								free_jobs > 0
							}
							add_district = district_generator
						}
						50 = {
							modifier = {
								factor = 0
								owner = { has_resource = { type = minerals amount < 100 } }
							}
							owner = { add_resource = { minerals = -100 } }
							add_district = district_city
						}
						100 = {
							add_district = district_industrial
							owner = { add_resource = { minerals = -100 } }
						}
					}
				}
				if = {
					limit = {
						owner = { has_monthly_income = { resource = minerals value > 100 } }
						num_districts = { type = district_mining value > 0 }
					}
					remove_district = district_mining
					random_list = {
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value = 0 }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = energy value > 20 } }
							}
							modifier = {
								factor = 0
								free_jobs > 0
							}
							add_district = district_generator
						}
						50 = {
							modifier = {
								factor = 0
								owner = { has_resource = { type = minerals amount < 100 } }
							}
							modifier = {
								factor = 0
								owner = { has_valid_civic = civic_agrarian_idyll }
								num_free_districts = { type = district_farming value > 0 }
							}
							owner = { add_resource = { minerals = -100 } }
							add_district = district_city
						}
						50 = {
							modifier = {
								factor = 0
								num_free_districts = { type = district_farming value = 0 }
							}
							modifier = {
								factor = 0
								owner = { NOT = { has_valid_civic = civic_agrarian_idyll } }
							}
							modifier = {
								factor = 10
								owner = { has_monthly_income = { resource = food value < 0 } }
							}
							add_district = district_farming
						}
						100 = {
							add_district = district_industrial
							owner = { add_resource = { minerals = -100 } }
						}
					}
				}
			}
		}
	}
country_event = {
	# if declare war AI subjucation
		id = phi_ai.18
	
		hide_window = yes
		is_triggered_only = yes
		trigger = {
			is_at_war = yes
			any_war = {
				any_attacker = {
					is_same_value = root
					is_war_leader = yes
					is_ai = yes
				}
				any_defender = {
					is_war_leader = yes
					is_ai = yes
				}
				OR = {
					using_war_goal = { type = wg_subjugation owner = attacker }
					using_war_goal = { type = wg_tribute owner = attacker }
				}
			}
		}
		immediate = {
			# THEN
			add_resource = { influence = -150} #remove 150 influence
		}
	}
	
	country_event = {
	#	phi_ai.30	yearly checked - Set Flag washuman
	
		id = phi_ai.30
		hide_window = yes
	
		is_triggered_only = yes
		
		trigger = {
			is_ai = no
			NOT = { has_country_flag = was_human }
		}
		immediate = {
			set_country_flag = was_human
		}
}
country_event = {
	
	#	phi_ai.40	YEARLI Mid game District update only artificial planet
	
	id = phi_ai.40
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		years_passed > 10
		is_ai = yes
		is_country_type = default
		owner = {
			has_resource = { type = minerals amount >= 400 }
			has_monthly_income = { resource = minerals value > 10 } 
		}
	}
	
	immediate = {
		every_owned_planet = {
			limit = {
				OR = {
					num_unemployed > 1
					free_jobs < 4 # if free jobs is < 2 (4-work police) probably use work clerk.
				}
				check_variable_arithmetic = { which = value:bslot_capacity_ai value > 12 }
				Can_remove_district_city = yes
				
			}
			if = { limit = { has_resource = { type = minerals amount >= 400 } }
			
				if = {
					limit = { has_district = district_city}
					remove_district = district_city
				}
				else_if = {
					limit = { has_district = district_hive}
					remove_district = district_hive
				}
				else_if = {
					limit = { has_district = district_nexus}
					remove_district = district_nexus
				}
				else_if = {
					limit = { has_district = district_crashed_slaver_ship}
					remove_district = district_crashed_slaver_ship
				}
				
				random_list = {
					20 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_generator value = 0 }
						}
						modifier = {
							factor = 0.1
							owner = { 
								is_machine_empire = no
								has_monthly_income = { resource = energy value > 50 } 
							}
						}
						add_district = district_generator
						owner = { add_resource = { minerals = -300 } }
					}
					15 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_mining value = 0 }
						}
						modifier = {
							factor = 0
							owner = { has_monthly_income = { resource = minerals value > 100 } }
						}
						modifier = {
							factor = 10
							owner = { has_monthly_income = { resource = minerals value < 50 } }
						}
						add_district = district_mining
						owner = { add_resource = { minerals = -300 } }
					}
					15 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_farming value = 0 }
						}
						modifier = {
							factor = 0.1
							owner = { 
								is_hive_empire = yes
								has_monthly_income = { resource = food value > 10 } 
							}
						}
						modifier = {
							factor = 20
							owner = { 
								has_monthly_income = { resource = food value < 1 } 
							}
						}
						add_district = district_farming
						owner = { add_resource = { minerals = -300 } }
					}
					20 = {
						modifier = {
							factor = 0
							num_free_districts = { type = district_industrial value = 0 }
						}
						modifier = {
							factor = 1.1
							owner = { 
								is_machine_empire = yes
							}
						}
						add_district = district_industrial
						owner = { add_resource = { minerals = -400 } }
						if = { 
							limit = { owner = { has_tradition = tr_adaptability_recycling  } }
							owner = { 
								add_resource = { minerals = 15 } 
							}
						}
					}
				}
				if = { 
					limit = { owner = { has_tradition = tr_adaptability_recycling  } }
					owner = { 
						add_resource = { minerals = 45 } 
					}
				}
			}
		}
	}
}
country_event = {#	phi_ai.41	YEARLI Universally remove/replace pop assembly
	
	
	
	id = phi_ai.41
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		years_passed > 10
		is_ai = yes
		is_country_type = default
		has_resource = { type = minerals amount >= 400 }
	}
	
	immediate = {
		every_owned_planet = {
			limit = {
				Planet_need_work_job = yes
				has_pop_assembly_buildings = yes
				#has_resource = { type = minerals amount >= 400 }
			}
			if = {
				limit = { has_building = building_machine_assembly_complex_3 }
				remove_building = building_machine_assembly_complex_3
			}
			else_if = {
				limit = { has_building = building_machine_assembly_complex }
				remove_building = building_machine_assembly_complex
			}
			else_if = {
				limit = { has_building = building_machine_assembly_plant }
				remove_building = building_machine_assembly_plant
			}
			else_if = {
				limit = { has_building = building_robot_assembly_complex }
				remove_building = building_robot_assembly_complex
			}
			else_if = {
				limit = { has_building = building_robot_assembly_plant }
				remove_building = building_robot_assembly_plant
			}
			else_if = {
				limit = { has_building = building_spawning_pool }
				remove_building = building_spawning_pool
			}
			else_if = {
				limit = { has_building = building_offspring_nest }
				remove_building = building_offspring_nest
			}
			else_if = {
				limit = { has_building = building_clone_vats }
				remove_building = building_clone_vats
			}
			if = { 
				limit = { owner = { has_tradition = tr_adaptability_recycling  } }
				owner = { 
					add_resource = { minerals = 60 } 
					if = { 
						limit = { owner = { is_machine_empire = yes } }
						add_resource = { minerals = 30 }
					}
				}
			}
			
			random_list = {
				99 = {
					modifier = {
						factor = 0
						owner = { has_resource = { type = minerals amount < 500 } }
					}
					random_list = {
						20 = { #energy nexus
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value < 3 }
							}
							modifier = {
								factor = 10
								num_free_districts = { type = district_generator value > 6 }
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_energy_grid
									has_building = building_energy_nexus
								}
							}
							modifier = {
								factor = 0.1
								owner = { 
									is_machine_empire = no
									has_monthly_income = { resource = energy value > 50 } 
								}
							}
							modifier = {
								factor = 3
								has_planet_flag = energy_habitat
							}
							
							add_building = building_energy_grid
							owner = { 
								add_resource = { minerals = -400 } 
								if = { 
									limit = { is_robot_empire = yes }
									add_resource = { minerals = -100 } 
									add_resource = { alloys = -100 } 
								}
							}
							
						}
						30 = { #alloy foundry
							
							modifier = {
								factor = 0
								OR = {
									has_building = building_foundry_1
									has_building = building_foundry_2
									has_building = building_foundry_3
								}
							}
							modifier = {
								factor =  2
								
									OR = {
										owner = { is_a_total_war = yes }
										owner = { recently_lost_war = yes }
									}
								
							}
							modifier = {
								factor = 2
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 10
								num_free_districts = { type = district_industrial value > 6 }
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = minerals value > 50 } }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = minerals value < 20 } }
							}
							modifier = {
								factor = 1.1
								owner = { 
									is_machine_empire = yes 
								}
							}
							add_building = building_foundry_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						30 = { #consumergoods
							modifier = {
								factor = 0
								OR = {
									has_building = building_factory_1
									has_building = building_factory_2
									has_building = building_factory_3
								}
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = minerals value > 50 } }
							}
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = consumer_goods value > 10 } }
								}
							}
							modifier = {
								factor = 0
								owner = { 
									is_gestalt = yes 
								}
							}
							add_building = building_factory_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #exotic
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_exotic_gases }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = exotic_gases value < 3 } }
								}
							}
							modifier = {
								factor = 3
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 25 } }
									owner = { has_monthly_income = { resource = exotic_gases value < 0 } }
								}
							}
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = exotic_gases value > 4 } }
								}
							}
							add_building = building_refinery
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #motes
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_volatile_motes }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = volatile_motes value < 3 } }
								}
							}
							modifier = {
								factor = 3
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 25 } }
									owner = { has_monthly_income = { resource = volatile_motes value < 0 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = volatile_motes value > 4 } }
								}
							}
							add_building = building_chemical_plant
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #crystal_plant
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_rare_crystals }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = rare_crystals value < 3 } }
								}
							}
							modifier = {
								factor = 3
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 25 } }
									owner = { has_monthly_income = { resource = rare_crystals value < 0 } }
								}
							}
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = rare_crystals value > 4 } }
								}
							}
							add_building = building_crystal_plant
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #ministry_production
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_global_production_strategy 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = volatile_motes amount >= 50 }
											
										}
									}
									has_any_industry_district = no
									has_building = building_ministry_production
									has_building = building_production_center
								}
								
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 5 }
							}
							modifier = {
								factor = 10
								num_free_districts = { type = district_industrial value > 8 }
							}
							if = { limit = { owner = { is_gestalt = no } } #non uso regular empire perchè comprende fallen che possono essere gestalt
								add_building = building_ministry_production
							}
							else = {
								add_building = building_production_center
							}
							
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { volatile_motes = -50 } 
							}
						}
						20 = { #building_coordinated_fulfillment_center_1
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											is_relentless_industrialist_empire = yes
										}
									}
									has_any_industry_district = no
									has_building = building_coordinated_fulfillment_center_1
								}
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 5 }
							}
							modifier = {
								factor = 5
								num_free_districts = { type = district_industrial value > 8 }
							}
							add_building = building_coordinated_fulfillment_center_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						100 = { #building_archaeo_refinery
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_archaeo_refinery 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = minor_artifacts amount >= 50 }
										}
									}
									has_any_industry_district = no
									has_building = building_archaeo_refinery
								}
							}
							modifier = {
								factor = 1.25
								has_building = building_refinery
							}
							modifier = {
								factor = 1.25
								has_building = building_chemical_plant
							}
							modifier = {
								factor = 1.25
								has_building = building_crystal_plant
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = rare_crystals value < 3 } }
									owner = { has_monthly_income = { resource = exotic_gases value < 3 } }
									owner = { has_monthly_income = { resource = volatile_motes value < 3 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
								}
							}
							add_building = building_coordinated_fulfillment_center_1
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { minor_artifacts = -50 } 
							}
						}
						30 = { #building_physics_lab_1
							modifier = {
								factor = 0
								OR = {
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher
										OR = {
											owner = { is_hive_empire = yes }
											owner = { has_monthly_income = { resource = energy value < 10 } }
											owner = { has_monthly_income = { resource = minerals value < 2 } }
										}
										OR = {
											owner = { is_hive_empire = no}
											owner = { has_monthly_income = { resource = food value < 10 } }
											owner = { has_monthly_income = { resource = minerals value < 2 } }
										}
									}
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher_disallowed
										OR = {
											owner = { has_monthly_income = { resource = energy value < 16 } }
										}
									}
								}
								
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_physics_lab_1
									has_building = building_physics_lab_2
									has_building = building_physics_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_physics_lab_1 value > 2 }
									num_buildings = { type = building_physics_lab_2 value > 2 }
									num_buildings = { type = building_physics_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = physics_research value < 500 } }
							}
							modifier = {
								factor = 0.5
								owner = { has_monthly_income = { resource = physics_research value > 1000 } }
							}
							modifier = { 
								factor = 1.25
								owner = { NOT = { has_technology = tech_space_science_5 } }
							}
							
							
							add_building = building_physics_lab_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #building_engineering_lab_1
							modifier = {
								factor = 0
								OR = {
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher
										OR = {
											owner = { is_hive_empire = yes }
											owner = { has_monthly_income = { resource = energy value < 8 } }
											owner = { has_monthly_income = { resource = minerals value < 4 } }
										}
										OR = {
											owner = { is_hive_empire = no}
											owner = { has_monthly_income = { resource = food value < 8 } }
											owner = { has_monthly_income = { resource = minerals value < 4 } }
										}
									}
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher_disallowed
										OR = {
											owner = { has_monthly_income = { resource = energy value < 16 } }
										}
									}
								}
								
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_engineering_lab_1
									has_building = building_engineering_lab_2
									has_building = building_engineering_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 2 }
									num_buildings = { type = building_engineering_lab_2 value > 2 }
									num_buildings = { type = building_engineering_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 1.5
								owner = { 
									has_monthly_income = { resource = engineering_research value < 500 } 
									has_technology = tech_space_science_5
								}
							}
							modifier = {
								factor = 0.5
								owner = { has_monthly_income = { resource = engineering_research value > 1000 } }
							}
							
							add_building = building_engineering_lab_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #building_institute
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_global_research_initiative 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = exotic_gases amount >= 50 }
										}
										has_upgraded_capital = yes
									}
									has_building = building_institute
									NOR =  {
										has_building = building_engineering_lab_1
										has_building = building_physics_lab_1
										has_building = building_engineering_lab_2
										has_building = building_engineering_lab_3
										has_building = building_physics_lab_2
										has_building = building_physics_lab_3
									}
								}
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_engineering_lab_2
									has_building = building_engineering_lab_3
									has_building = building_physics_lab_2
									has_building = building_physics_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 2 }
									num_buildings = { type = building_engineering_lab_2 value > 2 }
									num_buildings = { type = building_engineering_lab_3 value > 2 }
									num_buildings = { type = building_physics_lab_1 value > 2 }
									num_buildings = { type = building_physics_lab_2 value > 2 }
									num_buildings = { type = building_physics_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 3 }
									num_buildings = { type = building_engineering_lab_2 value > 3 }
									num_buildings = { type = building_engineering_lab_3 value > 3 }
									num_buildings = { type = building_physics_lab_1 value > 3 }
									num_buildings = { type = building_physics_lab_2 value > 3 }
									num_buildings = { type = building_physics_lab_3 value > 3 }
								}
							}
							
							add_building = building_institute
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { exotic_gases = -50 } 
							}
						}
						20 = { #building_mineral_purification_plant
							modifier = {
								factor = 0
								OR = {
									NOT = { owner = { has_technology =  tech_mineral_purification_1 } }
									num_free_districts = { type = district_mining value < 4 }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_mineral_purification_plant
									has_building = building_mineral_purification_hub
								}
							}
							modifier = {
								factor = 0.1
								owner = { 
									is_lithoid_empire = no
									has_monthly_income = { resource = minerals value > 100 } 
								}
							}
							modifier = {
								factor = 1.25
								owner = { 
									has_monthly_income = { resource = minerals value < 50 } 
								}
							}
							modifier = {
								factor = 3
								owner = { 
									has_monthly_income = { resource = minerals value < 10 } 
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_monthly_income = { resource = minerals value < 0 } 
								}
							}
							add_building = building_mineral_purification_plant
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						20 = { #food processing
							modifier = {
								factor = 0
								OR = {
									owner = { country_uses_food = no }
									is_planet_class = pc_machine
									NOT = { owner = { has_technology =  tech_food_processing_1 } }
									num_free_districts = { type = district_farming value < 4 }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_food_processing_facility
									has_building = building_food_processing_center
								}
							}
							modifier = {
								factor = 0.5
								owner = { 
									owner = { is_hive_empire = no}
									has_monthly_income = { resource = food value > 50 } 
								}
							}
							modifier = {
								factor = 3
								owner = { 
									has_monthly_income = { resource = food value < 10 } 
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_monthly_income = { resource = food value < 0 } 
								}
							}
							add_building = building_food_processing_facility
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						20 = { #building_commercial_zone
							modifier = {
								factor = 0
								OR = {
									owner = { is_regular_empire = no }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 2
								owner = {
									should_ai_focus_on_trade = yes
								}
							}
							modifier = {
								factor = 3
								owner = {
									has_active_tradition = tr_mercantile_commercial_enterprise
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_active_tradition = tr_mercantile_commercial_enterprise
									OR = {
										has_monthly_income = { resource = energy value < 10 } 
										has_monthly_income = { resource = consumer_goods value < 5 } 
									}
								}
							}
							add_building = building_commercial_zone
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						45 = { #building_galactic_stock_exchange
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_galactic_markets 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = rare_crystals amount >= 50 }
										}
										has_upgraded_capital = yes
									}
									has_building = building_galactic_stock_exchange
									owner = { is_regular_empire = no }
									NOR =  {
										has_building = building_commercial_zone
										has_building = building_commercial_megaplex
									}
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 1 }
									num_buildings = { type = building_commercial_megaplex value > 1 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 2 }
									num_buildings = { type = building_commercial_megaplex value > 2 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 3 }
									num_buildings = { type = building_commercial_megaplex value > 3 }
								}
							}
							modifier = {
								factor = 0.25
								owner = {
									should_ai_focus_on_trade = no
								}
							}
							modifier = {
								factor = 3
								owner = {
									has_active_tradition = tr_mercantile_commercial_enterprise
								}
							}
							modifier = {
								factor = 1.25
								owner = { 
									has_active_tradition = tr_mercantile_commercial_enterprise
									OR = {
										has_monthly_income = { resource = energy value < 10 } 
										has_monthly_income = { resource = consumer_goods value < 5 } 
									}
								}
							}
							
							add_building = building_galactic_stock_exchange
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { rare_crystals = -50 } 
							}
						}
					}
					
					add_modifier = { modifier = Phi_auto_ai_malus days = 365 } 
				}
				1 = {}
			}
		}
	}
}



country_event = {
#	phi_ai.777	test event

	id = phi_ai.777
	
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		is_country_type = default
	}
	
	immediate = {
		every_owned_planet = {
			limit = {
				OR = {
					num_unemployed > 1
					free_jobs < 4 # if free jobs is < 2 (4-work police) probably use work clerk.
				}
				check_variable_arithmetic = { which = value:bslot_capacity_ai value > 12 }
				Can_remove_district_city = yes
				owner = { has_resource = { type = minerals amount > 400 } }
			}
			if = {
				limit = { has_district = district_city}
				remove_district = district_city
			}
			else_if = {
				limit = { has_district = district_hive}
				remove_district = district_hive
			}
			else_if = {
				limit = { has_district = district_nexus}
				remove_district = district_nexus
			}
			else_if = {
				limit = { has_district = district_crashed_slaver_ship}
				remove_district = district_crashed_slaver_ship
			}
			
			random_list = {
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_generator value = 0 }
					}
					modifier = {
						factor = 0.1
						owner = { 
							is_machine_empire = no
							has_monthly_income = { resource = energy value > 50 } 
						}
					}
					add_district = district_generator
					owner = { add_resource = { minerals = -300 } }
				}
				15 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_mining value = 0 }
					}
					modifier = {
						factor = 0
						owner = { has_monthly_income = { resource = minerals value > 100 } }
					}
					modifier = {
						factor = 10
						owner = { has_monthly_income = { resource = minerals value < 50 } }
					}
					add_district = district_mining
					owner = { add_resource = { minerals = -300 } }
				}
				15 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_farming value = 0 }
					}
					modifier = {
						factor = 0.1
						owner = { 
							is_hive_empire = yes
							has_monthly_income = { resource = food value > 10 } 
						}
					}
					modifier = {
						factor = 20
						owner = { 
							has_monthly_income = { resource = food value < 1 } 
						}
					}
					add_district = district_farming
					owner = { add_resource = { minerals = -300 } }
				}
				20 = {
					modifier = {
						factor = 0
						num_free_districts = { type = district_industrial value = 0 }
					}
					modifier = {
						factor = 1.1
						owner = { 
							is_machine_empire = yes
						}
					}
					add_district = district_industrial
					owner = { add_resource = { minerals = -400 } }
					if = { 
						limit = { owner = { has_tradition = tr_adaptability_recycling  }}
						owner = { 
							add_resource = { minerals = 15 } 
						}
					}
				}
			}
			if = { 
				limit = { owner = { has_tradition = tr_adaptability_recycling  }}
				owner = { 
					add_resource = { minerals = 45 } 
				}
			}
		}
	}
}
planet_event = {
	#	phi_ai.778	test event for planetsw
	
	id = phi_ai.778
	
	hide_window = yes

	is_triggered_only = yes
	
	trigger = {
		AND = {
			Planet_need_work_job = yes
			has_pop_assembly_buildings = yes
		}
	}
	
	immediate = {
			if = {
				limit = {
					Planet_need_work_job = yes
					has_pop_assembly_buildings = yes
					#has_resource = { type = minerals amount >= 400 }
				}
			if = {
				limit = { has_building = building_machine_assembly_complex_3 }
				remove_building = building_machine_assembly_complex_3
			}
			else_if = {
				limit = { has_building = building_machine_assembly_complex }
				remove_building = building_machine_assembly_complex
			}
			else_if = {
				limit = { has_building = building_machine_assembly_plant }
				remove_building = building_machine_assembly_plant
			}
			else_if = {
				limit = { has_building = building_robot_assembly_complex }
				remove_building = building_robot_assembly_complex
			}
			else_if = {
				limit = { has_building = building_robot_assembly_plant }
				remove_building = building_robot_assembly_plant
			}
			else_if = {
				limit = { has_building = building_spawning_pool }
				remove_building = building_spawning_pool
			}
			else_if = {
				limit = { has_building = building_offspring_nest }
				remove_building = building_offspring_nest
			}
			else_if = {
				limit = { has_building = building_clone_vats }
				remove_building = building_clone_vats
			}
			if = { 
				limit = { owner = { has_tradition = tr_adaptability_recycling  } }
				owner = { 
					add_resource = { minerals = 60 } 
					if = { 
						limit = { owner = { is_machine_empire = no } }
						add_resource = { minerals = 30 }
					}
				}
			}
			
			random_list = {
				99 = {
					modifier = {
						factor = 0
						owner = { has_resource = { type = minerals amount < 500 } }
					}
					random_list = {
						20 = { #energy nexus
							modifier = {
								factor = 0
								num_free_districts = { type = district_generator value < 3 }
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_energy_grid
									has_building = building_energy_nexus
								}
							}
							modifier = {
								factor = 0.1
								owner = { 
									is_machine_empire = no
									has_monthly_income = { resource = energy value > 50 } 
								}
							}
							modifier = {
								factor = 3
								has_planet_flag = energy_habitat
							}
							
							add_building = building_energy_grid
							owner = { 
								add_resource = { minerals = -400 } 
								if = { 
									limit = { is_robot_empire = yes }
									add_resource = { minerals = -100 } 
									add_resource = { alloys = -100 } 
								}
							}
							
						}
						30 = { #alloy foundry
							
							modifier = {
								factor = 0
								OR = {
									has_building = building_foundry_1
									has_building = building_foundry_2
									has_building = building_foundry_3
								}
							}
							modifier = {
								factor =  2
								OR = {
									owner = { is_a_total_war = yes }
									owner = { recently_lost_war = yes }
								}
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = minerals value > 50 } }
							}
							modifier = {
								factor = 0
								owner = { has_monthly_income = { resource = minerals value < 20 } }
							}
							modifier = {
								factor = 1.1
								owner = { 
									is_machine_empire = yes 
								}
							}
							add_building = building_foundry_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						30 = { #consumergoods
							modifier = {
								factor = 0
								OR = {
									has_building = building_factory_1
									has_building = building_factory_2
									has_building = building_factory_3
								}
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = minerals value > 50 } }
							}
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = consumer_goods value > 10 } }
								}
							}
							modifier = {
								factor = 0
								owner = { 
									is_gestalt = yes 
								}
							}
							add_building = building_factory_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #exotic
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_exotic_gases }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = exotic_gases value < 3 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = exotic_gases value > 4 } }
								}
							}
							add_building = building_refinery
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #motes
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_volatile_motes }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = volatile_motes value < 3 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = volatile_motes value > 4 } }
								}
							}
							add_building = building_chemical_plant
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #crystal_plant
							modifier = {
								factor = 0
								NOT = {
									owner = { has_technology = tech_rare_crystals }
								}
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = rare_crystals value < 3 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
									owner = { has_monthly_income = { resource = rare_crystals value > 4 } }
								}
							}
							add_building = building_crystal_plant
							owner = { 
								add_resource = { minerals = -500 } 
								
							}
						}
						20 = { #ministry_production
							modifier = {
								factor = 0
								OR = {
									NOT = {
									owner = { 
										has_technology = tech_global_production_strategy 
										has_resource = { type = minerals amount >= 600 }
										has_resource = { type = volatile_motes amount >= 50 }
										
									}
									}
									has_any_industry_district = no
									has_building = building_ministry_production
									has_building = building_production_center
								}
								
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 5 }
							}
							modifier = {
								factor = 5
								num_free_districts = { type = district_industrial value > 8 }
							}
							if = { limit = { owner = { is_gestalt = no } } #non uso regular empire perchè comprende fallen che possono essere gestalt
								add_building = building_ministry_production
							}
							else = {
								add_building = building_production_center
							}
							
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { volatile_motes = -50 } 
							}
						}
						20 = { #building_coordinated_fulfillment_center_1
							modifier = {
								factor = 0
								NOT = {
									owner = { 
										is_relentless_industrialist_empire = yes
									}
								}
								has_any_industry_district = no
								has_building = building_coordinated_fulfillment_center_1
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 3 }
							}
							modifier = {
								factor = 1.25
								num_free_districts = { type = district_industrial value > 5 }
							}
							modifier = {
								factor = 5
								num_free_districts = { type = district_industrial value > 8 }
							}
							add_building = building_coordinated_fulfillment_center_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						100 = { #building_archaeo_refinery
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_archaeo_refinery 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = minor_artifacts amount >= 50 }
										}
									}
									has_any_industry_district = no
									has_building = building_archaeo_refinery
								}
							}
							modifier = {
								factor = 1.25
								has_building = building_refinery
							}
							modifier = {
								factor = 1.25
								has_building = building_chemical_plant
							}
							modifier = {
								factor = 1.25
								has_building = building_crystal_plant
							}
							modifier = {
								factor = 1.5
								OR = {
									owner = { has_monthly_income = { resource = minerals value > 50 } }
									owner = { has_monthly_income = { resource = rare_crystals value < 3 } }
									owner = { has_monthly_income = { resource = exotic_gases value < 3 } }
									owner = { has_monthly_income = { resource = volatile_motes value < 3 } }
								}
							}
							
							modifier = {
								factor = 0
								OR = {
									owner = { has_monthly_income = { resource = minerals value < 20 } }
								}
							}
							add_building = building_coordinated_fulfillment_center_1
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { minor_artifacts = -50 } 
							}
						}
						30 = { #building_physics_lab_1
							modifier = {
								factor = 0
								OR = {
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher
										OR = {
											owner = { is_hive_empire = yes }
											owner = { has_monthly_income = { resource = energy value < 10 } }
											owner = { has_monthly_income = { resource = minerals value < 2 } }
										}
										OR = {
											owner = { is_hive_empire = no}
											owner = { has_monthly_income = { resource = food value < 10 } }
											owner = { has_monthly_income = { resource = minerals value < 2 } }
										}
									}
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher_disallowed
										OR = {
											owner = { has_monthly_income = { resource = energy value < 16 } }
										}
									}
								}
								
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_physics_lab_1
									has_building = building_physics_lab_2
									has_building = building_physics_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_physics_lab_1 value > 2 }
									num_buildings = { type = building_physics_lab_2 value > 2 }
									num_buildings = { type = building_physics_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 1.5
								owner = { has_monthly_income = { resource = physics_research value < 500 } }
							}
							modifier = { 
								factor = 1.25
								NOT = { owner = { has_technology = tech_space_science_5 } }
							}
							
							
							add_building = building_physics_lab_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #building_engineering_lab_1
							modifier = {
								factor = 0
								OR = {
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher
										OR = {
											owner = { is_hive_empire = yes }
											owner = { has_monthly_income = { resource = energy value < 8 } }
											owner = { has_monthly_income = { resource = minerals value < 4 } }
										}
										OR = {
											owner = { is_hive_empire = no}
											owner = { has_monthly_income = { resource = food value < 8 } }
											owner = { has_monthly_income = { resource = minerals value < 4 } }
										}
									}
									AND = {
										has_global_flag = phi_realistic_upkeep_researcher_disallowed
										OR = {
											owner = { has_monthly_income = { resource = energy value < 16 } }
										}
									}
								}
								
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_engineering_lab_1
									has_building = building_engineering_lab_2
									has_building = building_engineering_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 2 }
									num_buildings = { type = building_engineering_lab_2 value > 2 }
									num_buildings = { type = building_engineering_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 1.5
								owner = { 
									has_monthly_income = { resource = engineering_research value < 500 } 
									has_technology = tech_space_science_5
								}
							}
							
							add_building = building_engineering_lab_1
							owner = { 
								add_resource = { minerals = -400 } 
							}
						}
						30 = { #building_institute
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_global_research_initiative 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = exotic_gases amount >= 50 }
										}
										has_upgraded_capital = yes
									}
									has_building = building_institute
									NOR =  {
										has_building = building_engineering_lab_1
										has_building = building_physics_lab_1
										has_building = building_engineering_lab_2
										has_building = building_engineering_lab_3
										has_building = building_physics_lab_2
										has_building = building_physics_lab_3
									}
								}
							}
							modifier = {
								factor = 1.25
								OR = {
									has_building = building_engineering_lab_2
									has_building = building_engineering_lab_3
									has_building = building_physics_lab_2
									has_building = building_physics_lab_3
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 2 }
									num_buildings = { type = building_engineering_lab_2 value > 2 }
									num_buildings = { type = building_engineering_lab_3 value > 2 }
									num_buildings = { type = building_physics_lab_1 value > 2 }
									num_buildings = { type = building_physics_lab_2 value > 2 }
									num_buildings = { type = building_physics_lab_3 value > 2 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_engineering_lab_1 value > 3 }
									num_buildings = { type = building_engineering_lab_2 value > 3 }
									num_buildings = { type = building_engineering_lab_3 value > 3 }
									num_buildings = { type = building_physics_lab_1 value > 3 }
									num_buildings = { type = building_physics_lab_2 value > 3 }
									num_buildings = { type = building_physics_lab_3 value > 3 }
								}
							}
							
							add_building = building_institute
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { exotic_gases = -50 } 
							}
						}
						20 = { #building_mineral_purification_plant
							modifier = {
								factor = 0
								OR = {
									NOT = { owner = { has_technology =  tech_mineral_purification_1 } }
									num_free_districts = { type = district_mining value < 4 }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_mineral_purification_plant
									has_building = building_mineral_purification_hub
								}
							}
							modifier = {
								factor = 0.1
								owner = { 
									is_lithoid_empire = no
									has_monthly_income = { resource = minerals value > 100 } 
								}
							}
							modifier = {
								factor = 1.25
								owner = { 
									has_monthly_income = { resource = minerals value < 50 } 
								}
							}
							modifier = {
								factor = 3
								owner = { 
									has_monthly_income = { resource = minerals value < 10 } 
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_monthly_income = { resource = minerals value < 0 } 
								}
							}
							add_building = building_mineral_purification_plant
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						20 = { #food processing
							modifier = {
								factor = 0
								OR = {
									owner = { country_uses_food = no }
									is_planet_class = pc_machine
									NOT = { owner = { has_technology =  tech_food_processing_1 } }
									num_free_districts = { type = district_farming value < 4 }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 0
								OR = {
									has_building = building_food_processing_facility
									has_building = building_food_processing_center
								}
							}
							modifier = {
								factor = 0.5
								owner = { 
									owner = { is_hive_empire = no}
									has_monthly_income = { resource = food value > 50 } 
								}
							}
							modifier = {
								factor = 3
								owner = { 
									has_monthly_income = { resource = food value < 10 } 
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_monthly_income = { resource = food value < 0 } 
								}
							}
							add_building = building_food_processing_facility
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						20 = { #building_commercial_zone
							modifier = {
								factor = 0
								OR = {
									owner = { is_regular_empire = no }
									has_upgraded_capital = no
								}
							}
							modifier = {
								factor = 2
								owner = {
									should_ai_focus_on_trade = yes
								}
							}
							modifier = {
								factor = 3
								owner = {
									has_active_tradition = tr_mercantile_commercial_enterprise
								}
							}
							modifier = {
								factor = 5
								owner = { 
									has_active_tradition = tr_mercantile_commercial_enterprise
									OR = {
										has_monthly_income = { resource = energy value < 10 } 
										has_monthly_income = { resource = consumer_goods value < 5 } 
									}
								}
							}
							add_building = building_commercial_zone
							owner = { 
								add_resource = { minerals = -400 } 
							}
							
						}
						45 = { #building_galactic_stock_exchange
							modifier = {
								factor = 0
								OR = {
									NOT = {
										owner = { 
											has_technology = tech_galactic_markets 
											has_resource = { type = minerals amount >= 600 }
											has_resource = { type = rare_crystals amount >= 50 }
										}
										has_upgraded_capital = yes
									}
									has_building = building_galactic_stock_exchange
									owner = { is_regular_empire = no }
									NOR =  {
										has_building = building_commercial_zone
										has_building = building_commercial_megaplex
									}
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 1 }
									num_buildings = { type = building_commercial_megaplex value > 1 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 2 }
									num_buildings = { type = building_commercial_megaplex value > 2 }
								}
							}
							modifier = {
								factor = 3
								OR = {
									num_buildings = { type = building_commercial_zone value > 3 }
									num_buildings = { type = building_commercial_megaplex value > 3 }
								}
							}
							modifier = {
								factor = 0.25
								owner = {
									should_ai_focus_on_trade = no
								}
							}
							modifier = {
								factor = 3
								owner = {
									has_active_tradition = tr_mercantile_commercial_enterprise
								}
							}
							modifier = {
								factor = 1.25
								owner = { 
									has_active_tradition = tr_mercantile_commercial_enterprise
									OR = {
										has_monthly_income = { resource = energy value < 10 } 
										has_monthly_income = { resource = consumer_goods value < 5 } 
									}
								}
							}
							
							add_building = building_galactic_stock_exchange
							owner = { 
								add_resource = { minerals = -600 } 
								add_resource = { rare_crystals = -50 } 
							}
						}
						
						
					}
					
					add_modifier = { modifier = Phi_auto_ai_malus days = 365 } 
				}
				1 = {}
			}
		}
	}
}
