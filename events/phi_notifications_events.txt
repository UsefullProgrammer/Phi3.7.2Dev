namespace = phi_notification
# Check if player can discover L-Gate insight via Minor Artifact
@message_alert_display_duration_days_tier_2 = 30
country_event = {
	id = phi_notification.0
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_ai = no
	}
	immediate = {
		country_event = { 
			id = phi_notification.1  #notification artifact_lgate_insight_cooldown
			days = 1
		} 
		country_event = { 
			id = phi_notification.2  #notification artifact_precursor_insight_cooldown
			days = 2
		} 
		country_event = { 
			id = phi_notification.3  #notification survive_avaible_target
			days = 3
		} 
	}
}
country_event = {
	id = phi_notification.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_resource = { type = minor_artifacts amount >= 1000 }
		has_country_flag = encountered_first_lgate
		NOT = { has_country_flag = completed_lcluster_chain }
		NOT = { has_global_flag = l_cluster_opened }
		has_distar = yes
	}

	immediate = {
		if = {
			limit = {
				NOT = { has_modifier = "artifact_lgate_insight_cooldown" } # Off Cooldown
			}
			create_message = {
				type = MESSAGE_TYPE_RELICS_MINOR_ARTIFACT_LGATE_AVAILABLE
				localization = MINOR_ARTIFACT_LGATE_ALERT_MESSAGE
				days = @message_alert_display_duration_days_tier_2
			
				#onclick = relics
			}
			set_country_flag = minor_artifact_lgate_notified_flag
		}
	}
}

# Check if player can discover Precursor Insight via Minor Artifact
# @minor_artifact_precursor_insight_notified_flag = notified_minor_artifact_precursor_insight
country_event = {
	id = phi_notification.2
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		
		has_resource = { type = minor_artifacts amount >= 500 }
		Has_precursor_chain = yes
		# OR = {
		# 	has_country_flag = minor_artifact_precursor_insight_notified_flag
		# }
	}

	immediate = {
		if = {
			limit = {
				NOT = { has_modifier = "artifact_precursor_insight_cooldown" } # Off Cooldown
			}
			create_message = {
				type = MESSAGE_TYPE_RELICS_MINOR_ARTIFACT_PRECURSOR_AVAILABLE
				localization = MINOR_ARTIFACT_PRECURSOR_ALERT_MESSAGE
				days = @message_alert_display_duration_days_tier_2
			
				target = event_target:$LEADER$
			}
			#set_country_flag = minor_artifact_precursor_insight_notified_flag
		
		}
	}
}
country_event = {
	id = phi_notification.3
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_country = {
			has_communications = root
			any_war = {
				using_war_goal = { type = wg_phi_survive owner = prev }
				defender_war_exhaustion < 0.5
			}
		}
	}

	immediate = {
        random_country = {
			limit = {
				has_communications = root
				any_war = {
					using_war_goal = { type = wg_phi_survive owner = prev }
					defender_war_exhaustion < 0.5
				}
			}
            save_event_target_as = survive_avaible_target
		}
		if = {
			limit = {
				exists = event_target:survive_avaible_target
				#NOT = { has_country_flag = phi_empire_in_survive_flag } # No Notified Flag
			}
			create_message = {
				type = MESSAGE_TYPE_EDICTS_PHI_EMPIRE_IN_SURVIVE_AVAIBLE
				localization = PHI_EMPIRE_IN_SURVIVE_AVAIBLE_ALERT_MESSAGE
				days = @message_alert_display_duration_days_tier_2
			
				target = event_target:survive_avaible_target
			}
			#set_country_flag = phi_empire_in_survive_flag
		
		} #else_if = {
			# Reset the notified flag when the player uses one to obtain insight.
		# 	limit = {
		# 		has_country_flag = phi_empire_in_survive_flag # No Notified Flag
		# 	}
		# 	remove_country_flag = phi_empire_in_survive_flag
		# }
	}
}